@model GaspApp.Models.DashboardViewModels.TranslationsViewModel

@{
	ViewData["Title"] = "Translations";
}

<div class="container">
	<section class="section">
		<h1 class="title">Translations</h1>
		<h2 class="subtitle">Manage site translations</h2>
	</section>
</div>
<table class="table is-fullwidth">
	<thead>
		<th>Key</th>
		<th>English</th>
		<th>Arabic</th>
		<th>Chinese</th>
		<th>French</th>
		<th>Russian</th>
		<th>Spanish</th>
		<th>Options</th>
	</thead>
	<tbody>
		@foreach (var item in Model!.Items)
		{
			<tr>
				<td class="key">@item.Key</td>
				@foreach (var cul in LocaleConstants.SUPPORTED_LOCALES_TWOLETTERS)
				{
					<td><input type="text" class="input is-small @cul" value="@item.Values[cul]" /></td>
				}
				<td class="field is-grouped">
					<button class="button is-small is-success is-light" onclick="st(this)">Save</button>
					<button class="button is-small is-warning is-light" onclick="st(this)">Auto</button>
				</td>
			</tr>
		}
	</tbody>
</table>

<script>
	function st(element) {
		let auto = element.innerText === 'Auto';

		let path = auto ? "/Dashboard/AutoTranslation" : "/Dashboard/ModifyTranslation";
		let row = element.parentNode.parentNode;
		let key = row.querySelector('.key').innerText;
		let obj = {
			'key': key,
			'values': {}
		};

		for (x of ['en', 'ar', 'zh', 'fr', 'ru', 'es']) {
			obj['values'][x] = row.querySelector('.'+x).value;
		}

		let s = fetch(path, {
			method: 'POST',
			body: JSON.stringify(obj),
			headers: {
				'Content-Type': 'application/json'
			}
		});
		s.then(function (response) {
			return response.json();
		}).then(function(data) {
			console.log(data);
			for (k in data['values']) {
				let v = data['values'][k]
				row.querySelector('.'+k).value = v;
			}
		}).catch(function(err) {
			console.log(err);
		});
	}
</script>